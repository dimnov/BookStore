import{j as s,L as y,u as w,r as i,S as N,A as v,f as D,h as k,i as g,q as B,o as I,k as R,l as b,m as S,n as h,p as F,t as P,I as T,v as O,w as V,x as K}from"./index-80c5f547.js";import{c as H,a as L,r as M}from"./favoriteService-d7ad43b0.js";const C="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAARCAYAAAAPFIbmAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAADSSURBVHgBhZK9DcIwEIXjo8gasAEjJEV6mADYIFRRKqCI8lfABoyQBRIlI8AG3iKdzR2yI4hteM09WZ/u3cnneag8zwPvh4AAAOjruj65oEXXdTyKopWUMsbK27Z9ziGmTVEUPWMsEEKEaZoOX3Ha+L6/xfLA6CbLsrW1k1pgSfORVx25AblAAyJVVUVxPS7Dx3EMrRCpLMsNlga7HcAF4aY7ZQdwxN0xijodaSZwAHu0lyRJbsZ2M+Cs3+Fj0KsNmCAE6HNjG/CO01fgAib9u6cXvwlrKVZSRnsAAAAASUVORK5CYII=";function X(t){const{product:a}=t;return s.jsxs("div",{className:"breadcrum",children:[s.jsx(y,{to:"/shop",children:"SHOP"}),s.jsx("img",{src:C,alt:""}),s.jsx(y,{to:"/shop",children:a.category}),s.jsx("img",{src:C,alt:""}),a.name]})}function Z({product:t}){return s.jsxs(s.Fragment,{children:[s.jsx("h1",{children:t.name}),s.jsx("div",{className:"productdisplay-right-prices",children:s.jsxs("div",{className:"productdisplay-right-price-new",children:["$",t.price]})}),s.jsx("div",{className:"productdisplay-right-description",children:t.description})]})}function Q({currentUser:t,isInFavorites:a,handleToggleFavorite:e,addToCart:n,isAdmin:c,deleteBookHandler:o}){return s.jsxs("div",{className:"buttons-section",children:[s.jsx("button",{className:"add-to-cart",onClick:()=>{n()},children:"ADD TO CART"}),t?s.jsx("button",{className:"add-to-favourite",onClick:e,children:a?"REMOVE":"ADD TO FAVORITE"}):null,c?s.jsx("button",{className:"delete-book",onClick:()=>{o()},children:"DELETE"}):null]})}function Y({images:t}){return s.jsx("div",{className:"productdisplay-img-list",children:t.map((a,e)=>s.jsx("img",{src:a,alt:`book image ${e+1}`},e))})}function $(t){const a=w(),{product:e,id:n}=t,{addToCart:c}=i.useContext(N),{currentUser:o}=i.useContext(v),[d,m]=i.useState(!1),A=async x=>{await k(x),a("/shop")},j=async()=>{o!=null&&o.uid&&await L(o.uid,e,n)},l=async()=>{o!=null&&o.uid&&await M(o.uid,n)},p=async()=>{o&&(d?await l():await j(),m(!d))};return i.useEffect(()=>{(async()=>{if(o!=null&&o.uid){const f=await H(o.uid,n);m(f)}})()},[n,o==null?void 0:o.uid]),s.jsxs("div",{className:"productdisplay",children:[s.jsxs("div",{className:"productdisplay-left",children:[s.jsx(Y,{images:[e.image,e.image,e.image,e.image]}),s.jsx("div",{className:"productdisplay-img",children:s.jsx("img",{className:"productdisplay-main-img",src:e.image,alt:"book-cover"})})]}),s.jsxs("div",{className:"productdisplay-right",children:[s.jsx(Z,{product:e}),s.jsx(Q,{currentUser:o,isInFavorites:d,handleToggleFavorite:p,addToCart:()=>c(n),isAdmin:(o==null?void 0:o.uid)===D,deleteBookHandler:()=>A(n)})]})]})}const q=async t=>{const a=g(h,"books",t,"comments"),e=B(a,I("timestamp"));return(await R(e)).docs.map(o=>({...o.data(),id:o.id}))},W=async(t,a,e)=>{const n=g(h,"books",t,"comments");await F(n,{user:a?a.email:"",comment:e,timestamp:new Date})},G=async(t,a)=>{const e=b(h,"books",t,"comments",a);await S(e)},z=async(t,a,e)=>{const n=g(h,"books",t,"comments"),c=b(n,a);await P(c,{comment:e,timestamp:new Date})};function J({comment:t,currentUser:a,handleEdit:e,handleDelete:n}){return s.jsxs("div",{children:[s.jsx("h4",{children:t.user}),s.jsx("p",{children:t.comment}),a&&a.email===t.user&&s.jsxs("div",{children:[s.jsx("button",{className:"edit-btn",onClick:()=>e(t.id,t.comment),children:"Edit"}),s.jsx("button",{className:"del-btn",onClick:()=>n(t.id),children:"Delete"})]})]})}function U({comments:t,currentUser:a,handleEdit:e,handleDelete:n}){return s.jsx("div",{className:"commentsbox-comments",children:t.map(c=>s.jsx(J,{comment:c,currentUser:a,handleEdit:e,handleDelete:n},c.id))})}function _({comment:t,setComment:a,error:e,handleSubmit:n,editingCommentId:c}){return s.jsxs("form",{onSubmit:n,children:[s.jsx("input",{value:t,onChange:o=>a(o.target.value)}),s.jsx("span",{children:e}),s.jsx("button",{type:"submit",children:c?"Edit Comment":"Add Comment"})]})}function ss({bookId:t}){const{currentUser:a}=i.useContext(v),[e,n]=i.useState(""),[c,o]=i.useState([]),[d,m]=i.useState(null),[A,j]=i.useState(),l=async()=>{try{const r=await q(t);o(r)}catch(r){console.error("Error fetching comments: ",r)}},p=async()=>{try{d?(await z(t,d,e),m(null)):await W(t,a,e),n(""),l()}catch(r){console.error("Error adding/editing comment: ",r)}},x=async r=>{try{await G(t,r),l()}catch(u){console.error("Error deleting comment: ",u)}};i.useEffect(()=>{l()},[t]);const f=async r=>{if(r.preventDefault(),e.trim()===""){j("Comment cannot be empty.");return}try{await p()}catch(u){console.error("Error adding/editing comment: ",u)}},E=(r,u)=>{m(r),n(u)};return s.jsxs("div",{className:"commentsbox",children:[s.jsx("div",{className:"commentsbox-navigator",children:s.jsx("div",{className:"commentsbox-nav-box",children:"Comments"})}),s.jsx(U,{comments:c,currentUser:a,handleEdit:E,handleDelete:x}),a?s.jsx(_,{comment:e,setComment:n,error:A,handleSubmit:f,editingCommentId:d}):null]})}function ts({product:t}){const[a,e]=i.useState([]),n=4;return i.useEffect(()=>{(async()=>{if(t!=null&&t.category){const o=await O(n,t.category);e(o)}})()},[t]),s.jsxs("div",{className:"relatedproducts",children:[s.jsx("h1",{children:"Related Books"}),s.jsx("hr",{}),s.jsx("div",{className:"relatedproducts-item",children:a.map((c,o)=>s.jsx(T,{id:c.id,name:c.name,image:c.image,price:c.price},o))})]})}function as(){const[t,a]=i.useState({}),{productId:e}=V();return i.useEffect(()=>{(async()=>{const c=await K(e);a(c)})()},[e]),s.jsxs("div",{children:[s.jsx(X,{product:t}),s.jsx($,{product:t,id:e}),s.jsx(ss,{bookId:e}),s.jsx(ts,{product:t})]})}export{as as default};
